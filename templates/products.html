{% extends "base.html" %}

{% block title %}商品管理{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
</style>
<script>
tailwind.config={
theme:{
extend:{
colors:{
primary:'#6366F1',
secondary:'#34D399'
},
borderRadius:{
'none':'0px',
'sm':'4px',
DEFAULT:'8px',
'md':'12px',
'lg':'16px',
'xl':'20px',
'2xl':'24px',
'3xl':'32px',
'full':'9999px',
'button':'8px'
}
}
}
}
</script>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
<!-- 页面标题和操作栏 -->
<div class="mb-8">
<div class="flex items-center justify-between mb-6">
<div>
<h1 class="text-3xl font-bold text-gray-900 mb-2">商品管理</h1>
<p class="text-gray-600">管理商品信息，包括商品分类、库存状态、价格设置等核心数据</p>
</div>
<button id="addProductBtn" class="px-6 py-3 bg-primary text-white rounded-button whitespace-nowrap hover:bg-primary/90 transition-colors flex items-center space-x-2">
<div class="w-4 h-4 flex items-center justify-center">
<i class="ri-add-line"></i>
</div>
<span>新增商品</span>
</button>
</div>
<!-- 搜索和筛选栏 -->
<div class="bg-white/60 backdrop-blur-lg rounded-2xl p-6 shadow-lg border border-white/20 mb-6">
<div class="flex flex-wrap items-center gap-4">
<div class="flex-1 min-w-64">
<div class="relative">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
<div class="w-5 h-5 flex items-center justify-center">
<i class="ri-search-line text-gray-400"></i>
</div>
</div>
<input type="text" id="searchInput" placeholder="搜索商品名称、编号或描述..." class="w-full pl-10 pr-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm">
</div>
</div>
<div class="flex items-center space-x-4">
<select id="categoryFilter" class="px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm pr-8">
<option value="">全部分类</option>
<option value="fresh-fruit">新鲜水果</option>
<option value="dried-fruit">干果坚果</option>
<option value="fruit-juice">果汁饮品</option>
<option value="fruit-snack">果脯零食</option>
</select>
<select id="stockFilter" class="px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm pr-8">
<option value="">库存状态</option>
<option value="in-stock">有库存</option>
<option value="low-stock">库存不足</option>
<option value="out-of-stock">缺货</option>
</select>
<button id="advancedFilterBtn" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-button whitespace-nowrap hover:bg-gray-200 transition-colors flex items-center space-x-2">
<div class="w-4 h-4 flex items-center justify-center">
<i class="ri-filter-line"></i>
</div>
<span>高级筛选</span>
</button>
<button id="batchActionBtn" class="px-6 py-3 bg-secondary/10 text-secondary rounded-button whitespace-nowrap hover:bg-secondary hover:text-white transition-colors flex items-center space-x-2">
<div class="w-4 h-4 flex items-center justify-center">
<i class="ri-checkbox-multiple-line"></i>
</div>
<span>批量操作</span>
</button>
</div>
</div>
</div>
</div>
            
            <!-- 商品列表 -->
            <div class="bg-white/60 backdrop-blur-lg rounded-2xl shadow-lg border border-white/20 overflow-hidden">
                {% if products %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50/80 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left">
                                    <input type="checkbox" id="selectAll" class="w-4 h-4 text-primary rounded">
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">商品图片</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:text-primary transition-colors">
                                    <div class="flex items-center space-x-1">
                                        <span>商品名称</span>
                                        <div class="w-4 h-4 flex items-center justify-center">
                                            <i class="ri-arrow-up-down-line text-gray-400"></i>
                                        </div>
                                    </div>
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">分类</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:text-primary transition-colors">
                                    <div class="flex items-center space-x-1">
                                        <span>售价</span>
                                        <div class="w-4 h-4 flex items-center justify-center">
                                            <i class="ri-arrow-up-down-line text-gray-400"></i>
                                        </div>
                                    </div>
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:text-primary transition-colors">
                                    <div class="flex items-center space-x-1">
                                        <span>库存</span>
                                        <div class="w-4 h-4 flex items-center justify-center">
                                            <i class="ri-arrow-up-down-line text-gray-400"></i>
                                        </div>
                                    </div>
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">状态</th>
                                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">操作</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50/50 transition-colors cursor-pointer product-row">
                                <td class="px-6 py-4">
                                    <input type="checkbox" class="product-checkbox w-4 h-4 text-primary rounded">
                                </td>
                                <td class="px-6 py-4">
                                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-red-100 to-orange-100">
                                        <img src="https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?w=64&h=64&fit=crop&crop=center" alt="红富士苹果" class="w-full h-full object-cover object-top">
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div>
                                        <div class="font-semibold text-gray-900">红富士苹果</div>
                                        <div class="text-sm text-gray-500">编号: FRT001</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        新鲜水果
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-gray-900">¥ 12.80/kg</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-green-600">580 kg</div>
                                    <div class="text-sm text-gray-500">安全库存</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        在售
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center space-x-2">
                                        <button class="w-8 h-8 bg-blue-100 hover:bg-blue-200 rounded-full flex items-center justify-center transition-colors view-detail-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-eye-line text-blue-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-green-100 hover:bg-green-200 rounded-full flex items-center justify-center transition-colors edit-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-edit-line text-green-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-orange-100 hover:bg-orange-200 rounded-full flex items-center justify-center transition-colors stock-manage-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-archive-line text-orange-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors delete-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-delete-bin-line text-red-600"></i>
                                            </div>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition-colors cursor-pointer product-row">
                                <td class="px-6 py-4">
                                    <input type="checkbox" class="product-checkbox w-4 h-4 text-primary rounded">
                                </td>
                                <td class="px-6 py-4">
                                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-orange-100 to-yellow-100">
                                        <img src="https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=64&h=64&fit=crop&crop=center" alt="脐橙" class="w-full h-full object-cover object-top">
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div>
                                        <div class="font-semibold text-gray-900">赣南脐橙</div>
                                        <div class="text-sm text-gray-500">编号: FRT002</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        新鲜水果
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-gray-900">¥ 15.60/kg</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-orange-600">45 kg</div>
                                    <div class="text-sm text-orange-500">库存不足</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        在售
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center space-x-2">
                                        <button class="w-8 h-8 bg-blue-100 hover:bg-blue-200 rounded-full flex items-center justify-center transition-colors view-detail-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-eye-line text-blue-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-green-100 hover:bg-green-200 rounded-full flex items-center justify-center transition-colors edit-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-edit-line text-green-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-orange-100 hover:bg-orange-200 rounded-full flex items-center justify-center transition-colors stock-manage-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-archive-line text-orange-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors delete-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-delete-bin-line text-red-600"></i>
                                            </div>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition-colors cursor-pointer product-row">
                                <td class="px-6 py-4">
                                    <input type="checkbox" class="product-checkbox w-4 h-4 text-primary rounded">
                                </td>
                                <td class="px-6 py-4">
                                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-purple-100 to-pink-100">
                                        <img src="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=64&h=64&fit=crop&crop=center" alt="香蕉" class="w-full h-full object-cover object-top">
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div>
                                        <div class="font-semibold text-gray-900">进口香蕉</div>
                                        <div class="text-sm text-gray-500">编号: FRT003</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        新鲜水果
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-gray-900">¥ 8.90/kg</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-red-600">0 kg</div>
                                    <div class="text-sm text-red-500">缺货</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        下架
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center space-x-2">
                                        <button class="w-8 h-8 bg-blue-100 hover:bg-blue-200 rounded-full flex items-center justify-center transition-colors view-detail-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-eye-line text-blue-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-green-100 hover:bg-green-200 rounded-full flex items-center justify-center transition-colors edit-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-edit-line text-green-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-orange-100 hover:bg-orange-200 rounded-full flex items-center justify-center transition-colors stock-manage-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-archive-line text-orange-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors delete-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-delete-bin-line text-red-600"></i>
                                            </div>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition-colors cursor-pointer product-row">
                                <td class="px-6 py-4">
                                    <input type="checkbox" class="product-checkbox w-4 h-4 text-primary rounded">
                                </td>
                                <td class="px-6 py-4">
                                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-yellow-100 to-orange-100">
                                        <img src="https://images.unsplash.com/photo-1599599810769-bcde5a160d32?w=64&h=64&fit=crop&crop=center" alt="坚果" class="w-full h-full object-cover object-top">
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div>
                                        <div class="font-semibold text-gray-900">每日坚果</div>
                                        <div class="text-sm text-gray-500">编号: NUT001</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                                        干果坚果
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-gray-900">¥ 28.80/盒</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-green-600">320 盒</div>
                                    <div class="text-sm text-gray-500">安全库存</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        在售
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center space-x-2">
                                        <button class="w-8 h-8 bg-blue-100 hover:bg-blue-200 rounded-full flex items-center justify-center transition-colors view-detail-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-eye-line text-blue-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-green-100 hover:bg-green-200 rounded-full flex items-center justify-center transition-colors edit-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-edit-line text-green-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-orange-100 hover:bg-orange-200 rounded-full flex items-center justify-center transition-colors stock-manage-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-archive-line text-orange-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors delete-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-delete-bin-line text-red-600"></i>
                                            </div>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50/50 transition-colors cursor-pointer product-row">
                                <td class="px-6 py-4">
                                    <input type="checkbox" class="product-checkbox w-4 h-4 text-primary rounded">
                                </td>
                                <td class="px-6 py-4">
                                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-blue-100 to-purple-100">
                                        <img src="https://images.unsplash.com/photo-1600271886742-f049cd451bba?w=64&h=64&fit=crop&crop=center" alt="果汁" class="w-full h-full object-cover object-top">
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div>
                                        <div class="font-semibold text-gray-900">鲜榨橙汁</div>
                                        <div class="text-sm text-gray-500">编号: JUC001</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        果汁饮品
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-gray-900">¥ 18.50/瓶</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="font-semibold text-green-600">156 瓶</div>
                                    <div class="text-sm text-gray-500">安全库存</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        在售
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center space-x-2">
                                        <button class="w-8 h-8 bg-blue-100 hover:bg-blue-200 rounded-full flex items-center justify-center transition-colors view-detail-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-eye-line text-blue-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-green-100 hover:bg-green-200 rounded-full flex items-center justify-center transition-colors edit-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-edit-line text-green-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-orange-100 hover:bg-orange-200 rounded-full flex items-center justify-center transition-colors stock-manage-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-archive-line text-orange-600"></i>
                                            </div>
                                        </button>
                                        <button class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors delete-product-btn">
                                            <div class="w-4 h-4 flex items-center justify-center">
                                                <i class="ri-delete-bin-line text-red-600"></i>
                                            </div>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                     </table>
                 </div>

                 <!-- 分页 -->
                 <div class="flex items-center justify-between px-6 py-4 border-t border-gray-200">
                     <div class="flex items-center text-sm text-gray-500">
                         显示 1-5 条，共 5 条记录
                     </div>
                     <div class="flex items-center space-x-2">
                         <button class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50" disabled>
                             上一页
                         </button>
                         <button class="px-3 py-1 text-sm bg-primary text-white rounded-lg">
                             1
                         </button>
                         <button class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50" disabled>
                             下一页
                         </button>
                     </div>
                 </div>
                 {% else %}
                 <div class="text-center py-16">
                     <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                         <i class="ri-shopping-bag-line text-4xl text-gray-400"></i>
                     </div>
                     <h3 class="text-xl font-semibold text-gray-900 mb-2">暂无商品</h3>
                     <p class="text-gray-600 mb-6">添加您的第一个商品，开始管理您的商品库存</p>
                     {% if current_user.role != 'employee' %}
                     <a href="{{ url_for('add_product') }}" class="px-6 py-3 bg-primary text-white rounded-button hover:bg-primary/90 transition-colors flex items-center space-x-2 mx-auto w-fit">
                         <div class="w-4 h-4 flex items-center justify-center">
                             <i class="ri-add-line"></i>
                         </div>
                         <span>添加商品</span>
                     </a>
                     {% endif %}
                 </div>
                 {% endif %}
             </div>
         </div>
     </main>
</div>

<!-- 新增/编辑商品模态框 -->
<div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">新增商品</h3>
                    <button class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors" onclick="closeModal('productModal')">
                        <i class="ri-close-line text-gray-600"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form class="space-y-6">
                    <!-- 基本信息 -->
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-4">基本信息</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">商品名称</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入商品名称">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">商品编号</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="自动生成或手动输入">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">商品分类</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">请选择分类</option>
                                    <option value="新鲜水果">新鲜水果</option>
                                    <option value="干果坚果">干果坚果</option>
                                    <option value="果汁饮品">果汁饮品</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">商品状态</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="在售">在售</option>
                                    <option value="下架">下架</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 价格设置 -->
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-4">价格设置</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">售价</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">¥</span>
                                    <input type="number" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="0.00" step="0.01">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">单位</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="如：kg、盒、瓶等">
                            </div>
                        </div>
                    </div>

                    <!-- 库存管理 -->
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-4">库存管理</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">当前库存</label>
                                <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="0" min="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">安全库存</label>
                                <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="0" min="0">
                            </div>
                        </div>
                    </div>

                    <!-- 商品图片 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品图片</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors">
                            <i class="ri-image-line text-3xl text-gray-400 mb-2"></i>
                            <p class="text-sm text-gray-500 mb-2">点击上传或拖拽图片到此处</p>
                            <p class="text-xs text-gray-400">支持 JPG、PNG 格式，大小不超过 2MB</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                    </div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                <button class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" onclick="closeModal('productModal')">
                    取消
                </button>
                <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 商品详情模态框 -->
<div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">商品详情</h3>
                    <button class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors" onclick="closeModal('detailModal')">
                        <i class="ri-close-line text-gray-600"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="w-full h-48 bg-gray-100 rounded-xl overflow-hidden mb-4">
                            <div class="w-full h-full bg-gradient-to-br from-red-100 to-pink-100 flex items-center justify-center">
                                <svg class="w-16 h-16 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-gray-500">商品名称</label>
                            <p class="text-lg font-semibold text-gray-900">红富士苹果</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">商品编号</label>
                            <p class="text-gray-900">FRT001</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">分类</label>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                新鲜水果
                            </span>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">售价</label>
                            <p class="text-lg font-semibold text-gray-900">¥ 12.80/kg</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">库存</label>
                            <p class="text-green-600 font-semibold">580 kg</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">状态</label>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                在售
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 库存管理模态框 -->
<div id="stockModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">库存管理</h3>
                    <button class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors" onclick="closeModal('stockModal')">
                        <i class="ri-close-line text-gray-600"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品名称</label>
                        <p class="text-gray-900 font-semibold">红富士苹果</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">当前库存</label>
                        <p class="text-2xl font-bold text-green-600">580 kg</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">操作类型</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="入库">入库</option>
                            <option value="出库">出库</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">数量</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入数量" min="1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">备注</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" rows="3" placeholder="请输入备注信息（可选）"></textarea>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                <button class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" onclick="closeModal('stockModal')">
                    取消
                </button>
                <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    确认
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 删除确认模态框 -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
            <div class="p-6">
                <div class="flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 rounded-full">
                    <i class="ri-delete-bin-line text-red-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 text-center mb-2">确认删除</h3>
                <p class="text-gray-500 text-center mb-6">确定要删除这个商品吗？此操作不可撤销。</p>
                <div class="flex justify-center space-x-3">
                    <button class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" onclick="closeModal('deleteModal')">
                        取消
                    </button>
                    <button class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 商品详情模态框 -->
<div id="productDetailModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center">
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-8 w-full max-w-5xl mx-4 shadow-2xl border border-white/20 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-900">商品详情</h3>
            <button id="closeDetailModal" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors">
                <i class="ri-close-line text-gray-600"></i>
            </button>
        </div>
        <div class="space-y-8">
            <!-- 商品信息 -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">商品信息</h4>
                <div class="flex items-start space-x-6">
                    <div class="w-32 h-32 rounded-2xl overflow-hidden bg-gradient-to-br from-blue-100 to-purple-100 flex-shrink-0 flex items-center justify-center">
                        <svg class="w-16 h-16 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V19C3 20.1 3.9 21 5 21H11.81C12.45 21.69 13.3 22.16 14.27 22.27C15.5 22.42 16.74 22.05 17.68 21.27C18.62 20.5 19.16 19.4 19.16 18.27C19.16 17.14 18.62 16.04 17.68 15.27C16.74 14.5 15.5 14.13 14.27 14.27C13.3 14.38 12.45 14.85 11.81 15.54H5V3H14V8H19V9H21ZM17 16.5C17.83 16.5 18.5 17.17 18.5 18S17.83 19.5 17 19.5 15.5 18.83 15.5 18 16.17 16.5 17 16.5Z"/>
                        </svg>
                    </div>
                    <div class="flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <div class="text-sm text-gray-500 mb-1">商品名称</div>
                            <div class="font-semibold text-gray-900" id="detailProductName">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">商品编号</div>
                            <div class="font-semibold text-gray-900" id="detailProductCode">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">商品分类</div>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800" id="detailProductCategory">
                                未分类
                            </span>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">售价</div>
                            <div class="font-semibold text-gray-900" id="detailProductPrice">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">成本价</div>
                            <div class="font-semibold text-gray-900" id="detailProductCost">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">商品状态</div>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium" id="detailProductStatus">
                                -
                            </span>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="text-sm text-gray-500 mb-1">商品描述</div>
                    <div class="text-gray-900" id="detailProductDescription">暂无描述</div>
                </div>
            </div>
            <!-- 库存统计 -->
            <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">库存统计</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600 mb-1" id="detailCurrentStock">-</div>
                        <div class="text-sm text-gray-600">当前库存</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600 mb-1" id="detailMinStock">-</div>
                        <div class="text-sm text-gray-600">最低库存</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-1" id="detailMaxStock">-</div>
                        <div class="text-sm text-gray-600">最高库存</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600 mb-1" id="detailStockStatus">-</div>
                        <div class="text-sm text-gray-600">库存状态</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 库存管理模态框 -->
<div id="stockModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center">
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-8 w-full max-w-2xl mx-4 shadow-2xl border border-white/20">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-900">库存管理</h3>
            <button id="closeStockModal" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors">
                <i class="ri-close-line text-gray-600"></i>
            </button>
        </div>
        <div class="space-y-6">
            <!-- 当前库存信息 -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">当前库存信息</h4>
                <div class="grid grid-cols-2 gap-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600 mb-2" id="stockCurrentAmount">-</div>
                        <div class="text-sm text-gray-600">当前库存</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-orange-600 mb-2" id="stockMinAmount">-</div>
                        <div class="text-sm text-gray-600">最低库存</div>
                    </div>
                </div>
            </div>
            <!-- 库存操作 -->
            <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">库存操作</h4>
                <form id="stockForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">操作类型</label>
                            <select id="stockOperationType" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 pr-8">
                                <option value="in">入库</option>
                                <option value="out">出库</option>
                                <option value="adjust">调整</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">变动数量</label>
                            <input type="number" id="stockQuantity" min="1" required class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">操作备注</label>
                        <textarea id="stockRemark" rows="3" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 resize-none" placeholder="请输入操作备注..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-4 pt-4">
                        <button type="button" id="cancelStockBtn" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-button whitespace-nowrap hover:bg-gray-200 transition-colors">取消</button>
                        <button type="submit" class="px-6 py-3 bg-primary text-white rounded-button whitespace-nowrap hover:bg-primary/90 transition-colors">确认操作</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 删除确认模态框 -->
<div id="deleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center">
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-8 w-full max-w-md mx-4 shadow-2xl border border-white/20">
        <div class="text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="ri-error-warning-line text-red-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">确认删除</h3>
            <p class="text-gray-600 mb-6">您确定要删除这个商品吗？此操作不可撤销。</p>
            <div class="flex justify-center space-x-4">
                <button id="cancelDeleteBtn" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-button whitespace-nowrap hover:bg-gray-200 transition-colors">取消</button>
                <button id="confirmDeleteBtn" class="px-6 py-3 bg-red-500 text-white rounded-button whitespace-nowrap hover:bg-red-600 transition-colors">确认删除</button>
            </div>
        </div>
    </div>
</div>

<!-- 新增商品模态框 -->
<div id="addProductModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center">
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-8 w-full max-w-4xl mx-4 shadow-2xl border border-white/20 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-900">新增商品</h3>
            <button id="closeAddProductModal" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors">
                <i class="ri-close-line text-gray-600"></i>
            </button>
        </div>
        <form id="addProductForm" class="space-y-8">
            <!-- 基本信息 -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">基本信息</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品名称 <span class="text-red-500">*</span></label>
                        <input type="text" id="addProductName" name="name" required class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品分类 <span class="text-red-500">*</span></label>
                        <select id="addProductCategory" name="category_id" required class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 pr-8">
                            <option value="">请选择分类</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">售价 <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">¥</span>
                            <input type="number" id="addProductPrice" name="selling_price" required step="0.01" min="0" class="w-full pl-8 pr-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">成本价</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">¥</span>
                            <input type="number" id="addProductCost" name="cost_price" step="0.01" min="0" class="w-full pl-8 pr-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">计量单位</label>
                        <select id="addProductUnit" name="unit" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 pr-8">
                            <option value="件">件</option>
                            <option value="kg">千克(kg)</option>
                            <option value="g">克(g)</option>
                            <option value="个">个</option>
                            <option value="盒">盒</option>
                            <option value="瓶">瓶</option>
                            <option value="袋">袋</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品状态</label>
                        <select id="addProductStatus" name="is_active" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 pr-8">
                            <option value="1">在售</option>
                            <option value="0">停售</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">商品描述</label>
                    <textarea id="addProductDescription" name="description" rows="3" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <button type="button" id="cancelAddProductBtn" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-button whitespace-nowrap hover:bg-gray-200 transition-colors">取消</button>
                <button type="submit" class="px-6 py-3 bg-primary text-white rounded-button whitespace-nowrap hover:bg-primary/90 transition-colors">保存商品</button>
            </div>
        </form>
    </div>
</div>

<!-- 编辑商品模态框 -->
<div id="editProductModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center">
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-8 w-full max-w-4xl mx-4 shadow-2xl border border-white/20 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 id="editProductModalTitle" class="text-2xl font-bold text-gray-900">编辑商品</h3>
            <button id="closeEditProductModal" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors">
                <i class="ri-close-line text-gray-600"></i>
            </button>
        </div>
        <form id="editProductForm" class="space-y-8">
            <input type="hidden" id="editProductId" name="id">
            
            <!-- 商品图片 -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">商品图片</h4>
                <div class="flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-2xl p-8 hover:border-primary transition-colors cursor-pointer" id="editImageUploadArea">
                    <i class="ri-image-line text-3xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-500 mb-2">点击上传或拖拽图片到此处</p>
                    <p class="text-xs text-gray-400">支持 JPG、PNG、GIF 格式，最大 5MB</p>
                    <input type="file" id="editProductImage" name="image" accept="image/*" class="hidden">
                </div>
                <!-- 图片预览区域 -->
                <div id="editImagePreview" class="mt-4 hidden">
                    <div class="text-sm text-gray-600 mb-2">图片预览：</div>
                    <div id="editImagePreviewContainer" class="relative inline-block">
                        <img id="editPreviewImage" src="" alt="商品图片预览" class="w-32 h-32 object-cover rounded-lg border border-gray-200">
                        <button type="button" id="editRemoveImage" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">
                            <i class="ri-close-line text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 基本信息 -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">基本信息</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品名称 <span class="text-red-500">*</span></label>
                        <input type="text" id="editProductName" name="name" required class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品分类 <span class="text-red-500">*</span></label>
                        <select id="editProductCategory" name="category_id" required class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 pr-8">
                            <option value="">请选择分类</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">售价 <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">¥</span>
                            <input type="number" id="editProductPrice" name="price" required step="0.01" min="0" class="w-full pl-8 pr-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">库存数量</label>
                        <input type="number" id="editProductStock" name="stock" min="0" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900">
                    </div>
                </div>
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">商品描述</label>
                    <textarea id="editProductDescription" name="description" rows="3" class="w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/20 text-gray-900 resize-none"></textarea>
                </div>
                <div class="mt-6">
                    <label class="flex items-center">
                        <input type="checkbox" id="editProductActive" name="is_active" class="w-4 h-4 text-primary rounded">
                        <span class="ml-2 text-sm text-gray-700">商品上架</span>
                    </label>
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <button type="button" id="cancelEditProductBtn" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-button whitespace-nowrap hover:bg-gray-200 transition-colors">取消</button>
                <button type="submit" class="px-6 py-3 bg-primary text-white rounded-button whitespace-nowrap hover:bg-primary/90 transition-colors">保存商品</button>
            </div>
        </form>
    </div>
</div>

<script>
// 模态框控制
function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

// 等待DOM加载完成
document.addEventListener('DOMContentLoaded', function() {
    // 全选/取消全选
    const selectAllCheckbox = document.getElementById('selectAll');
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }

    // 搜索功能
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('.product-row');
            
            rows.forEach(row => {
                const productNameElement = row.querySelector('td:nth-child(3) .font-semibold');
                const productCodeElement = row.querySelector('td:nth-child(3) .text-gray-500');
                
                if (productNameElement && productCodeElement) {
                    const productName = productNameElement.textContent.toLowerCase();
                    const productCode = productCodeElement.textContent.toLowerCase();
                    
                    if (productName.includes(searchTerm) || productCode.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });
    }

    // 分类筛选
    const categoryFilter = document.getElementById('categoryFilter');
    if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
            const selectedCategory = this.value;
            const rows = document.querySelectorAll('.product-row');
            
            rows.forEach(row => {
                const categoryElement = row.querySelector('td:nth-child(4) span');
                const category = categoryElement ? categoryElement.textContent.trim() : '';
                
                if (!selectedCategory || category === selectedCategory || category === '-') {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }

    // 库存筛选
    const stockFilter = document.getElementById('stockFilter');
    if (stockFilter) {
        stockFilter.addEventListener('change', function() {
            const selectedStock = this.value;
            const rows = document.querySelectorAll('.product-row');
            
            rows.forEach(row => {
                const stockElement = row.querySelector('td:nth-child(6) .text-sm');
                if (selectedStock === '') {
                    row.style.display = '';
                } else if (stockElement) {
                    const stockText = stockElement.textContent.toLowerCase();
                    if ((selectedStock === 'in-stock' && stockText.includes('安全库存')) ||
                        (selectedStock === 'low-stock' && stockText.includes('库存不足')) ||
                        (selectedStock === 'out-of-stock' && stockText.includes('缺货'))) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });
    }
    
    // 批量操作功能
    const batchActionBtn = document.querySelector('button[title="批量操作"]');
    if (batchActionBtn) {
        batchActionBtn.addEventListener('click', function() {
            const checkedBoxes = document.querySelectorAll('.product-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('请先选择要操作的商品');
                return;
            }
            
            // 这里可以添加批量操作的逻辑
            console.log('选中了', checkedBoxes.length, '个商品');
            alert(`已选择 ${checkedBoxes.length} 个商品，批量操作功能待实现`);
        });
    }
    
    // 高级筛选功能
    const advancedFilterBtn = document.querySelector('button[title="高级筛选"]');
    if (advancedFilterBtn) {
        advancedFilterBtn.addEventListener('click', function() {
            alert('高级筛选功能待实现');
        });
    }
    
    // 通用模态框关闭功能
    // 点击背景关闭模态框
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {
            e.target.classList.add('hidden');
        }
    });
    
    // ESC键关闭模态框
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
            modals.forEach(modal => {
                modal.classList.add('hidden');
            });
        }
    });
    
    // 使所有关闭按钮生效
    window.closeModal = closeModal;
    window.openModal = openModal;

    // 新增商品按钮
    const addProductBtn = document.getElementById('addProductBtn');
    if (addProductBtn) {
        addProductBtn.addEventListener('click', function() {
            openAddProductModal();
        });
    }

    // 查看详情按钮
    document.querySelectorAll('.view-detail-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            openProductDetailModal(productId);
        });
    });

    // 库存管理按钮
    document.querySelectorAll('.stock-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            openStockModal(productId);
        });
    });

    // 删除按钮
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            openDeleteModal(productId);
        });
    });

    // 编辑商品按钮
    document.querySelectorAll('.edit-product-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            openEditProductModal(productId);
        });
    });

    // 打开编辑商品模态框
    function openEditProductModal(productId) {
        // 获取商品数据
        fetch(`/api/product/${productId}`)
            .then(response => response.json())
            .then(product => {
                // 填充表单数据
                document.getElementById('editProductId').value = product.id;
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductCategory').value = product.category_id || '';
                document.getElementById('editProductPrice').value = product.price;
                document.getElementById('editProductStock').value = product.stock || 0;
                document.getElementById('editProductDescription').value = product.description || '';
                document.getElementById('editProductActive').checked = product.is_active;
                
                // 处理现有图片
                const imagePreview = document.getElementById('editImagePreview');
                const previewImage = document.getElementById('editPreviewImage');
                if (product.image_path) {
                    previewImage.src = product.image_path;
                    imagePreview.classList.remove('hidden');
                } else {
                    imagePreview.classList.add('hidden');
                }
                
                // 显示模态框
                document.getElementById('editProductModal').classList.remove('hidden');
            })
            .catch(error => {
                console.error('获取商品数据失败:', error);
                alert('获取商品数据失败，请重试');
            });
    }

    // 新增商品模态框控制
    const addProductModal = document.getElementById('addProductModal');
    const closeAddProductModal = document.getElementById('closeAddProductModal');
    const cancelAddProductBtn = document.getElementById('cancelAddProductBtn');
    const addProductForm = document.getElementById('addProductForm');

    // 编辑商品模态框控制
    const editProductModal = document.getElementById('editProductModal');
    const closeEditProductModal = document.getElementById('closeEditProductModal');
    const cancelEditProductBtn = document.getElementById('cancelEditProductBtn');
    const editProductForm = document.getElementById('editProductForm');
    const editImageUploadArea = document.getElementById('editImageUploadArea');
    const editProductImage = document.getElementById('editProductImage');
    const editImagePreview = document.getElementById('editImagePreview');
    const editPreviewImage = document.getElementById('editPreviewImage');
    const editRemoveImage = document.getElementById('editRemoveImage');

    // 打开新增商品模态框
    function openAddProductModal() {
        if (addProductModal) {
            addProductModal.classList.remove('hidden');
        }
    }

    // 关闭新增商品模态框
    function closeAddModal() {
        addProductModal.classList.add('hidden');
        addProductForm.reset();
    }

    // 新增商品模态框事件监听器
    closeAddProductModal.addEventListener('click', closeAddModal);
    cancelAddProductBtn.addEventListener('click', closeAddModal);

    // 点击模态框背景关闭新增模态框
    addProductModal.addEventListener('click', function(e) {
        if (e.target === addProductModal) {
            closeAddModal();
        }
    });

    // 关闭编辑模态框
    function closeEditModal() {
        editProductModal.classList.add('hidden');
        editProductForm.reset();
        editImagePreview.classList.add('hidden');
    }

    closeEditProductModal.addEventListener('click', closeEditModal);
    cancelEditProductBtn.addEventListener('click', closeEditModal);

    // 点击模态框背景关闭
    editProductModal.addEventListener('click', function(e) {
        if (e.target === editProductModal) {
            closeEditModal();
        }
    });

    // 图片上传区域点击事件
    editImageUploadArea.addEventListener('click', function() {
        editProductImage.click();
    });

    // 图片文件选择处理
    editProductImage.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // 验证文件类型
            if (!file.type.startsWith('image/')) {
                alert('请选择图片文件');
                return;
            }
            
            // 验证文件大小 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('图片大小不能超过5MB');
                return;
            }
            
            // 预览图片
            const reader = new FileReader();
            reader.onload = function(e) {
                editPreviewImage.src = e.target.result;
                editImagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    });

    // 移除图片
    editRemoveImage.addEventListener('click', function() {
        editProductImage.value = '';
        editImagePreview.classList.add('hidden');
    });

    // 拖拽上传功能
    editImageUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        editImageUploadArea.classList.add('border-primary');
    });

    editImageUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        editImageUploadArea.classList.remove('border-primary');
    });

    editImageUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        editImageUploadArea.classList.remove('border-primary');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith('image/')) {
                editProductImage.files = files;
                editProductImage.dispatchEvent(new Event('change'));
            } else {
                alert('请选择图片文件');
            }
        }
    });

    // 新增商品表单提交
    addProductForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(addProductForm);
        
        fetch('/add_product', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('商品添加成功');
                closeAddModal();
                location.reload(); // 刷新页面显示最新数据
            } else {
                alert(data.message || '添加商品失败，请重试');
            }
        })
        .catch(error => {
            console.error('添加商品失败:', error);
            alert('添加商品失败，请重试');
        });
    });

    // 编辑商品表单提交
    editProductForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(editProductForm);
        const productId = document.getElementById('editProductId').value;
        
        fetch(`/edit_product/${productId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                alert('商品更新成功');
                closeEditModal();
                location.reload(); // 刷新页面显示最新数据
            } else {
                return response.text().then(text => {
                    throw new Error(text);
                });
            }
        })
        .catch(error => {
            console.error('更新商品失败:', error);
            alert('更新商品失败，请重试');
        });
    });

    // 删除商品按钮
    document.querySelectorAll('.delete-product-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            if (confirm('确定要删除这个商品吗？此操作不可撤销。')) {
                window.location.href = `/delete_product/${productId}`;
            }
        });
    });

    // 模态框控制变量
    const productDetailModal = document.getElementById('productDetailModal');
    const stockModal = document.getElementById('stockModal');
    const deleteModal = document.getElementById('deleteModal');
    const closeDetailModal = document.getElementById('closeDetailModal');
    const closeStockModal = document.getElementById('closeStockModal');
    const cancelStockBtn = document.getElementById('cancelStockBtn');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    const stockForm = document.getElementById('stockForm');

    let currentProductId = null;

    // 打开商品详情模态框
    function openProductDetailModal(productId) {
        currentProductId = productId;
        // 获取商品详情数据
        fetch(`/api/product/${productId}`)
            .then(response => response.json())
            .then(product => {
                // 填充商品详情
                document.getElementById('detailProductName').textContent = product.name || '-';
                document.getElementById('detailProductCode').textContent = product.code || '-';
                document.getElementById('detailProductCategory').textContent = product.category || '未分类';
                document.getElementById('detailProductPrice').textContent = product.price ? `¥${product.price}` : '-';
                document.getElementById('detailProductCost').textContent = product.cost ? `¥${product.cost}` : '-';
                document.getElementById('detailProductDescription').textContent = product.description || '暂无描述';
                
                // 设置商品状态
                const statusElement = document.getElementById('detailProductStatus');
                const statusText = product.is_active ? '在售' : '下架';
                const statusClass = product.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                statusElement.textContent = statusText;
                statusElement.className = `inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${statusClass}`;
                
                // 填充库存信息
                document.getElementById('detailCurrentStock').textContent = product.stock || 0;
                document.getElementById('detailMinStock').textContent = product.min_stock || 0;
                document.getElementById('detailMaxStock').textContent = product.max_stock || '-';
                
                // 设置库存状态
                const stockStatusElement = document.getElementById('detailStockStatus');
                if (product.stock <= 0) {
                    stockStatusElement.textContent = '缺货';
                } else if (product.stock <= product.min_stock) {
                    stockStatusElement.textContent = '库存不足';
                } else {
                    stockStatusElement.textContent = '正常';
                }
                
                productDetailModal.classList.remove('hidden');
            })
            .catch(error => {
                console.error('获取商品详情失败:', error);
                alert('获取商品详情失败，请重试');
            });
    }

    // 打开库存管理模态框
    function openStockModal(productId) {
        currentProductId = productId;
        // 获取商品库存信息
        fetch(`/api/product/${productId}`)
            .then(response => response.json())
            .then(product => {
                document.getElementById('stockCurrentAmount').textContent = product.stock || 0;
                document.getElementById('stockMinAmount').textContent = product.min_stock || 0;
                stockModal.classList.remove('hidden');
            })
            .catch(error => {
                console.error('获取商品库存信息失败:', error);
                alert('获取商品库存信息失败，请重试');
            });
    }

    // 打开删除确认模态框
    function openDeleteModal(productId) {
        currentProductId = productId;
        deleteModal.classList.remove('hidden');
    }

    // 关闭模态框事件
    if (closeDetailModal) {
        closeDetailModal.addEventListener('click', () => {
            productDetailModal.classList.add('hidden');
        });
    }

    if (closeStockModal) {
        closeStockModal.addEventListener('click', () => {
            stockModal.classList.add('hidden');
        });
    }

    if (cancelStockBtn) {
        cancelStockBtn.addEventListener('click', () => {
            stockModal.classList.add('hidden');
        });
    }

    if (cancelDeleteBtn) {
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.add('hidden');
        });
    }

    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', () => {
            if (currentProductId) {
                window.location.href = `/delete_product/${currentProductId}`;
            }
        });
    }

    // 库存操作表单提交
    if (stockForm) {
        stockForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const operationType = document.getElementById('stockOperationType').value;
            const quantity = document.getElementById('stockQuantity').value;
            const remark = document.getElementById('stockRemark').value;
            
            const data = {
                operation_type: operationType,
                quantity: parseInt(quantity),
                remark: remark
            };
            
            fetch(`/api/product/${currentProductId}/stock`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('库存操作成功');
                    stockModal.classList.add('hidden');
                    location.reload();
                } else {
                    alert(result.message || '库存操作失败，请重试');
                }
            })
            .catch(error => {
                console.error('库存操作失败:', error);
                alert('库存操作失败，请重试');
            });
        });
    }
});
</script>
{% endblock %}